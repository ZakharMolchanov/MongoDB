version: "3.9"

services:
  # üîë AUTH SERVICE
  auth-service:
    build:
      context: ./auth-service
      dockerfile: Dockerfile
    container_name: auth-service
    restart: unless-stopped
    ports:
      - "5001:5001"
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@postgres:5432/mydb
      - SECRET_KEY=supersecretkey
      - ADMIN_EMAILS=admin@example.com
    depends_on:
      - postgres
    volumes:
      - ./auth-service:/app

  # ü§ñ AI SERVICE (DeepSeek)
  ai-integration-service:
    build:
      context: ./ai-integration-service
      dockerfile: Dockerfile
    container_name: ai-integration-service
    restart: unless-stopped
    ports:
      - "8088:8088"
    environment:
      - DEEPSEEK_API_KEY=sk-25f9861dd1a94f98a4017ae35de7cf37
      - DEEPSEEK_MODEL=deepseek-chat
      - DEEPSEEK_BASE=https://api.deepseek.com/v1
      - CORS_ALLOW_ORIGINS=http://localhost:5173,http://frontend:5173

  # üåê FRONTEND
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: mongo-trainer-frontend
    restart: unless-stopped
    ports:
      - "5173:5173"
  # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (/auth –∏ /api) –∏ –ø—Ä–æ–∫—Å–∏ Vite.
  # –£–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ VITE_AUTH_URL/VITE_CORE_URL, —á—Ç–æ–±—ã —Ñ—Ä–æ–Ω—Ç –Ω–µ –ø–æ—Å—ã–ª–∞–ª –∑–∞–ø—Ä–æ—Å—ã
  # –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
    volumes:
      - ./frontend:/app
      - /app/node_modules
    depends_on:
      - auth-service
      - core-service
      - ai-integration-service

  # üåê CORE SERVICE
  core-service:
    build:
      context: ./core-service
      dockerfile: Dockerfile
    container_name: core-service
    restart: unless-stopped
    ports:
      - "5002:5002"
    environment:
      - MONGO_URI=mongodb://mongo:27017/mongo_train
      - MONGO_DBNAME=mongo_train
    depends_on:
      - mongo
    volumes:
      - ./core-service:/app

  # üóÑ POSTGRES
  postgres:
    image: postgres:13
    restart: unless-stopped
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: mydb
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./docker/init_postgres.sql:/docker-entrypoint-initdb.d/init_postgres.sql

  # üçÉ MONGO
  mongo:
    image: mongo:5
    restart: unless-stopped
    ports:
      - "27017:27017"
    volumes:
      - ./docker/init_mongo.js:/docker-entrypoint-initdb.d/init_mongo.js

volumes:
  pgdata:
